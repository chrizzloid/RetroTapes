@page
@model RetroTapes.Pages.Customers.IndexModel

@{
    ViewData["Title"] = "Kunder";
}




<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3 mb-0">Customer services Dashboard</h1>
    <a asp-page="Create" class="btn btn-primary">Ny kund</a>
</div>

<form method="get" class="card card-body mb-3">
    <div class="row g-2">
        <div class="col-md-6">
            <input class="form-control" type="search" name="q" value="@Model.q" placeholder="Sök kund (namn eller email)" />
        </div>
        <div class="col-md-3">
            <select class="form-select" name="active">
                <option value="">Alla</option>
                <option value="true" selected="@(Model.active == true)">Aktiva</option>
                <option value="false" selected="@(Model.active == false)">Inaktiva</option>
            </select>
        </div>
        <div class="col-md-3 d-grid">
            <button class="btn btn-outline-secondary" type="submit">Filtrera</button>
        </div>
    </div>
</form>

@if (!Model.Result.Items.Any())
{
    <div class="alert alert-light border">
        Inga kunder matchar din filtrering. <a asp-page="Create">Skapa ny kund?</a>
    </div>
}

else
{
    <div class="table-responsive">
        <table class="table table-hover align-middle">
            <thead class="table-light sticky-top">
                <tr>
                    <th>
                        <a asp-page="./Index"
                           asp-route-q="@Model.q"
                           asp-route-active="@(Model.active?.ToString().ToLower())"
                           asp-route-sort="name"
                           asp-route-pageIndex="1"
                           asp-route-pageSize="@Model.pageSize"
                           class="text-decoration-none">Namn</a>
                        <span class="text-muted">/</span>
                        <a asp-page="./Index"
                           asp-route-q="@Model.q"
                           asp-route-active="@(Model.active?.ToString().ToLower())"
                           asp-route-sort="name_desc"
                           asp-route-pageIndex="1"
                           asp-route-pageSize="@Model.pageSize"
                           class="text-decoration-none">▼</a>
                    </th>
                    <th>
                        <a asp-page="./Index"
                           asp-route-q="@Model.q"
                           asp-route-active="@(Model.active?.ToString().ToLower())"
                           asp-route-sort="rentals"
                           asp-route-pageIndex="1"
                           asp-route-pageSize="@Model.pageSize"
                           class="text-decoration-none">Aktiva hyror</a>
                        <span class="text-muted">/</span>
                        <a asp-page="./Index"
                           asp-route-q="@Model.q"
                           asp-route-active="@(Model.active?.ToString().ToLower())"
                           asp-route-sort="rentals_desc"
                           asp-route-pageIndex="1"
                           asp-route-pageSize="@Model.pageSize"
                           class="text-decoration-none">▼</a>
                    </th>

                    <th>Active Customer</th>
                    <th>Email</th>
                    <th class="text-end">Åtgärder</th>

                </tr>
            </thead>
            <tbody>
                @foreach (var c in Model.Result.Items)
                {
                    <tr>
                        <td>@c.CustomerName</td>
                        <td>@c.ActiveRentals</td>
                        <td>@c.Active</td>                    
                        <td>@c.Email</td>
                        <td class="text-end">
                            <a asp-page="Details" asp-route-id="@c.CustomerId" class="btn btn-sm btn-outline-secondary">Visa</a>
                            <a asp-page="Edit" asp-route-id="@c.CustomerId" class="btn btn-sm btn-outline-primary">Redigera</a>
                            <a asp-page="Delete" asp-route-id="@c.CustomerId" class="btn btn-sm btn-outline-danger"
                               onclick="return confirm('Vill du ta bort kunden?');">Ta bort</a>

                        </td>
                    </tr>
                }
                </tbody>
        </table>
    </div>




    <nav class="d-flex justify-content-between align-items-center">
        <div class="text-muted">
            Sida @Model.Result.Page av @Model.Result.TotalPages (@Model.Result.TotalCount poster)
        </div>
        <ul class="pagination mb-0">
            @for (var i = 1; i <= Model.Result.TotalPages; i++)
            {
                <li class="page-item @(i == Model.Result.Page ? "active" : "")">
                    <a class="page-link" asp-page="./Index"
                       asp-route-q="@Model.q"
                       asp-route-active="@Model.active"
                       asp-route-sort="@Model.sort"
                       asp-route-pageIndex="@i"
                       asp-route-pageSize="@Model.pageSize">@i</a>
                </li>

            }
        </ul>
    </nav>

}





